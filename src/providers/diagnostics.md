# Провайдер Диагностики (`DiagnosticsProvider`)

Этот класс отвечает за генерацию кастомных ошибок и предупреждений (диагностик) в коде, которые VS Code отображает в виде волнистых подчеркиваний. В контексте данного расширения, его основная задача — находить потенциальные проблемы с импортами Angular-элементов, которые не могут быть обнаружены стандартным Angular Language Service.

## Принцип работы

`DiagnosticsProvider` — это не стандартный провайдер VS Code, а кастомная реализация, которая запускается расширением для анализа открытых файлов.

1.  **Активация**: Проверка запускается при открытии или изменении HTML-файла.
2.  **Парсинг HTML**:
    -   Провайдер парсит весь HTML-документ, чтобы извлечь из него все теги и их атрибуты. Для этого используется легковесный HTML-парсер.
    -   Он составляет список всех уникальных имен тегов (например, `my-component`) и атрибутов (например, `myDirective`, `bigRows`), найденных в документе.
3.  **Проверка на наличие в индексе**:
    -   Для каждого найденного тега и атрибута провайдер обращается к `AngularIndexer` и пытается найти его в индексе с помощью `indexer.getElement()`.
4.  **Проверка на наличие в текущем файле**:
    -   Если элемент **найден в индексе**, провайдер выполняет следующий, самый важный шаг: он парсит ассоциированный с HTML-шаблоном `.ts` файл компонента.
    -   Используя `ts-morph`, он проверяет, импортирован ли найденный элемент (например, `MyComponent` или `MyDirective`) в `@Component({ imports: [...] })` или в `@NgModule`.
5.  **Создание диагностики**:
    -   Если элемент найден в **индексе**, но **не импортирован** в `.ts` файле, провайдер создает объект `vscode.Diagnostic`.
    -   Эта диагностика содержит:
        -   Сообщение об ошибке (например, `Component 'MyComponent' is not imported.`).
        -   Диапазон в HTML-файле, который нужно подчеркнуть.
        -   Уровень серьезности (`vscode.DiagnosticSeverity.Warning` или `Error`).
        -   Специальный код ошибки (например, `missing-component-import`), который затем используется `QuickfixImportProvider` для предложения исправления.
6.  **Обновление ошибок в VS Code**:
    -   Собранная коллекция диагностик отправляется в VS Code, который отображает их в редакторе.

## Ключевая особенность

-   В отличие от стандартных линтеров, этот провайдер обладает полной информацией о **всех компонентах во всем проекте** (благодаря `AngularIndexer`). Это позволяет ему находить ошибки, связанные не с синтаксисом, а с отсутствием связей между файлами.
-   Он является источником данных для `QuickfixImportProvider`. Сначала `DiagnosticsProvider` создает ошибку, а затем `QuickfixImportProvider` предлагает для нее исправление. 