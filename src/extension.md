# Extension Entry Point (`extension.ts`)

Этот файл является главной точкой входа для всего расширения VS Code, как определено в `package.json`. Он отвечает за инициализацию и координацию всех основных компонентов при запуске и их корректное уничтожение при деактивации.

## Основные обязанности

### `activate(context: vscode.ExtensionContext)`

Эта функция вызывается VS Code один раз при активации расширения. Условия активации (например, открытие `.ts` файла, наличие `angular.json` и т.д.) настраиваются в `package.json` в секции `activationEvents`.

1.  **Загрузка конфигурации**: Чтение настроек VS Code, специфичных для этого расширения (например, из `settings.json`).
2.  **Определение проектов**: Находит все активные Angular-проекты в рабочем пространстве (multi-root workspaces поддерживаются).
3.  **Инициализация сервисов для каждого проекта**:
    -   Создает экземпляр `AngularIndexer` для каждого проекта, который будет отвечать за сканирование и индексацию компонентов, директив и пайпов.
    -   Создает экземпляр `TsConfigHelper` для помощи в разрешении путей (path aliases) из `tsconfig.json`.
4.  **Запуск начальной индексации**:
    -   Пытается загрузить индекс из кэша (`workspaceState`) для быстрого старта.
    -   Если кэш пуст или устарел, запускает полную асинхронную индексацию проекта. Для пользователя это может отображаться как уведомление с прогресс-баром.
5.  **Регистрация провайдеров (Providers)**:
    -   `CompletionItemProvider`: Регистрирует логику для автодополнения селекторов в HTML и пайпов.
    -   `CodeActionProvider` (`QuickfixImportProvider`): Регистрирует логику для "быстрых исправлений" (лампочка), которая предлагает импортировать недостающие модули.
    -   `DiagnosticProvider`: Регистрирует логику для кастомной диагностики (подчеркивания ошибок).
6.  **Регистрация команд (Commands)**:
    -   Регистрирует команды, которые пользователь может вызвать через палитру команд (Ctrl/Cmd+Shift+P), например, `Angular Auto Import: Reindex Project`.
7.  **Настройка наблюдателей (File Watchers)**:
    -   Инициализирует `FileSystemWatcher` для каждого проекта, чтобы отслеживать создание, удаление и изменение Angular-файлов в реальном времени и инкрементально обновлять индекс.

### `deactivate()`

Эта функция вызывается при выключении расширения. Ее главная задача — освободить все ресурсы, чтобы избежать утечек памяти.
-   Она уничтожает все созданные `Disposable` объекты: команды, провайдеры, наблюдатели за файлами.
-   Вызывает метод `dispose()` у каждого экземпляра `AngularIndexer` для очистки его внутренних кэшей.

## Ключевые взаимодействия

-   `extension.ts` выступает как **оркестратор**. Он не содержит сложной бизнес-логики, а вместо этого делегирует ее специализированным сервисам (`AngularIndexer`) и провайдерам (`QuickfixImportProvider`, `CompletionProvider`).
-   Он использует `context.subscriptions` — стандартный механизм VS Code для управления жизненным циклом объектов. Любой объект, добавленный в `subscriptions`, будет автоматически уничтожен при деактивации. 